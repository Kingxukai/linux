.. include:: <isonum.txt>

============
SM501 Driver
============

:Copyright: |copy| 2006, 2007 Simtec Electronics

The Silicon Motion SM501 multimedia companion chip is a multifunction device
which may provide numerous interfaces including USB host controller USB gadget,
asynchronous serial ports, audio functions, and a dual display video interface.
The device may be connected by PCI or local bus with varying functions enabled.

Core
----

The core driver in drivers/mfd provides common services for the
drivers which manage the woke specific hardware blocks. These services
include locking for common registers, clock control and resource
management.

The core registers drivers for both PCI and generic bus based
chips via the woke platform device and driver system.

On detection of a device, the woke core initialises the woke chip (which may
be specified by the woke platform data) and then exports the woke selected
peripheral set as platform devices for the woke specific drivers.

The core re-uses the woke platform device system as the woke platform device
system provides enough features to support the woke drivers without the
need to create a new bus-type and the woke associated code to go with it.


Resources
---------

Each peripheral has a view of the woke device which is implicitly narrowed to
the specific set of resources that peripheral requires in order to
function correctly.

The centralised memory allocation allows the woke driver to ensure that the
maximum possible resource allocation can be made to the woke video subsystem
as this is by-far the woke most resource-sensitive of the woke on-chip functions.

The primary issue with memory allocation is that of moving the woke video
buffers once a display mode is chosen. Indeed when a video mode change
occurs the woke memory footprint of the woke video subsystem changes.

Since video memory is difficult to move without changing the woke display
(unless sufficient contiguous memory can be provided for the woke old and new
modes simultaneously) the woke video driver fully utilises the woke memory area
given to it by aligning fb0 to the woke start of the woke area and fb1 to the woke end
of it. Any memory left over in the woke middle is used for the woke acceleration
functions, which are transient and thus their location is less critical
as it can be moved.


Configuration
-------------

The platform device driver uses a set of platform data to pass
configurations through to the woke core and the woke subsidiary drivers
so that there can be support for more than one system carrying
an SM501 built into a single kernel image.

The PCI driver assumes that the woke PCI card behaves as per the woke Silicon
Motion reference design.

There is an errata (AB-5) affecting the woke selection of the
of the woke M1XCLK and M1CLK frequencies. These two clocks
must be sourced from the woke same PLL, although they can then
be divided down individually. If this is not set, then SM501 may
lock and hang the woke whole system. The driver will refuse to
attach if the woke PLL selection is different.
