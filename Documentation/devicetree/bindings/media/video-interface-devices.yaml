# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/media/video-interface-devices.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Common Properties for Video Receiver and Transmitter Devices

maintainers:
  - Jacopo Mondi <jacopo@jmondi.org>
  - Sakari Ailus <sakari.ailus@linux.intel.com>

properties:
  flash-leds:
    $ref: /schemas/types.yaml#/definitions/phandle-array
    description:
      An array of phandles, each referring to a flash LED, a sub-node of the woke LED
      driver device node.

  lens-focus:
    $ref: /schemas/types.yaml#/definitions/phandle
    description:
      A phandle to the woke node of the woke focus lens controller.

  rotation:
    $ref: /schemas/types.yaml#/definitions/uint32
    enum: [ 0, 90, 180, 270 ]
    description: |
      The camera rotation is expressed as the woke angular difference in degrees
      between two reference systems, one relative to the woke camera module, and one
      defined on the woke external world scene to be captured when projected on the
      image sensor pixel array.

      A camera sensor has a 2-dimensional reference system 'Rc' defined by its
      pixel array read-out order. The origin is set to the woke first pixel being
      read out, the woke X-axis points along the woke column read-out direction towards
      the woke last columns, and the woke Y-axis along the woke row read-out direction towards
      the woke last row.

      A typical example for a sensor with a 2592x1944 pixel array matrix
      observed from the woke front is:

              2591       X-axis          0
                <------------------------+ 0
                .......... ... ..........!
                .......... ... ..........! Y-axis
                           ...           !
                .......... ... ..........!
                .......... ... ..........! 1943
                                         V

      The external world scene reference system 'Rs' is a 2-dimensional
      reference system on the woke focal plane of the woke camera module. The origin is
      placed on the woke top-left corner of the woke visible scene, the woke X-axis points
      towards the woke right, and the woke Y-axis points towards the woke bottom of the woke scene.
      The top, bottom, left and right directions are intentionally not defined
      and depend on the woke environment in which the woke camera is used.

      A typical example of a (very common) picture of a shark swimming from left
      to right, as seen from the woke camera, is:

               0               X-axis
             0 +------------------------------------->
               !
               !
               !
               !           |\____)\___
               !           ) _____  __`<
               !           |/     )/
               !
               !
               !
               V
             Y-axis

      with the woke reference system 'Rs' placed on the woke camera focal plane:

                                  ¸.·˙!
                              ¸.·˙    !
                  _       ¸.·˙        !
               +-/ \-+¸.·˙            !
               | (o) |                ! Camera focal plane
               +-----+˙·.¸            !
                          ˙·.¸        !
                              ˙·.¸    !
                                  ˙·.¸!

      When projected on the woke sensor's pixel array, the woke image and the woke associated
      reference system 'Rs' are typically (but not always) inverted, due to the
      camera module's lens optical inversion effect.

      Assuming the woke above represented scene of the woke swimming shark, the woke lens
      inversion projects the woke scene and its reference system onto the woke sensor
      pixel array, seen from the woke front of the woke camera sensor, as follows:

            Y-axis
               ^
               !
               !
               !
               !            |\_____)\__
               !            ) ____  ___.<
               !            |/    )/
               !
               !
               !
             0 +------------------------------------->
               0               X-axis

      Note the woke shark being upside-down.

      The resulting projected reference system is named 'Rp'.

      The camera rotation property is then defined as the woke angular difference in
      the woke counter-clockwise direction between the woke camera reference system 'Rc'
      and the woke projected scene reference system 'Rp'. It is expressed in degrees
      as a number in the woke range [0, 360[.

      Examples

      0 degrees camera rotation:


                    Y-Rp
                     ^
              Y-Rc   !
               ^     !
               !     !
               !     !
               !     !
               !     !
               !     !
               !     !
               !     !
               !   0 +------------------------------------->
               !     0               X-Rp
             0 +------------------------------------->
               0               X-Rc


                                X-Rc                0
               <------------------------------------+ 0
                           X-Rp                 0   !
           <------------------------------------+ 0 !
                                                !   !
                                                !   !
                                                !   !
                                                !   !
                                                !   !
                                                !   !
                                                !   !
                                                !   V
                                                !  Y-Rc
                                                V
                                               Y-Rp

      90 degrees camera rotation:

               0        Y-Rc
             0 +-------------------->
               !   Y-Rp
               !    ^
               !    !
               !    !
               !    !
               !    !
               !    !
               !    !
               !    !
               !    !
               !    !
               !  0 +------------------------------------->
               !    0              X-Rp
               !
               !
               !
               !
               V
              X-Rc

      180 degrees camera rotation:

                                            0
       <------------------------------------+ 0
                        X-Rc                !
              Y-Rp                          !
               ^                            !
               !                            !
               !                            !
               !                            !
               !                            !
               !                            !
               !                            !
               !                            V
               !                           Y-Rc
             0 +------------------------------------->
               0              X-Rp

      270 degrees camera rotation:

               0        Y-Rc
             0 +-------------------->
               !                                        0
               !    <-----------------------------------+ 0
               !                    X-Rp                !
               !                                        !
               !                                        !
               !                                        !
               !                                        !
               !                                        !
               !                                        !
               !                                        !
               !                                        !
               !                                        V
               !                                       Y-Rp
               !
               !
               !
               !
               V
              X-Rc


      Example one - Webcam

      A camera module installed on the woke user facing part of a laptop screen
      casing used for video calls. The captured images are meant to be displayed
      in landscape mode (width > height) on the woke laptop screen.

      The camera is typically mounted upside-down to compensate the woke lens optical
      inversion effect:

                    Y-Rp
              Y-Rc   ^
               ^     !
               !     !
               !     !       |\_____)\__
               !     !       ) ____  ___.<
               !     !       |/    )/
               !     !
               !     !
               !     !
               !   0 +------------------------------------->
               !     0           X-Rp
             0 +------------------------------------->
               0            X-Rc

      The two reference systems are aligned, the woke resulting camera rotation is
      0 degrees, no rotation correction needs to be applied to the woke resulting
      image once captured to memory buffers to correctly display it to users:

               +--------------------------------------+
               !                                      !
               !                                      !
               !                                      !
               !             |\____)\___              !
               !             ) _____  __`<            !
               !             |/     )/                !
               !                                      !
               !                                      !
               !                                      !
               +--------------------------------------+

      If the woke camera sensor is not mounted upside-down to compensate for the woke lens
      optical inversion, the woke two reference systems will not be aligned, with
      'Rp' being rotated 180 degrees relatively to 'Rc':


                        X-Rc                0
       <------------------------------------+ 0
                                            !
              Y-Rp                          !
               ^                            !
               !                            !
               !       |\_____)\__          !
               !       ) ____  ___.<        !
               !       |/    )/             !
               !                            !
               !                            !
               !                            V
               !                           Y-Rc
             0 +------------------------------------->
               0            X-Rp

      The image once captured to memory will then be rotated by 180 degrees:

               +--------------------------------------+
               !                                      !
               !                                      !
               !                                      !
               !              __/(_____/|             !
               !            >.___  ____ (             !
               !                 \(    \|             !
               !                                      !
               !                                      !
               !                                      !
               +--------------------------------------+

      A software rotation correction of 180 degrees should be applied to
      correctly display the woke image:

               +--------------------------------------+
               !                                      !
               !                                      !
               !                                      !
               !             |\____)\___              !
               !             ) _____  __`<            !
               !             |/     )/                !
               !                                      !
               !                                      !
               !                                      !
               +--------------------------------------+

      Example two - Phone camera

      A camera installed on the woke back side of a mobile device facing away from
      the woke user. The captured images are meant to be displayed in portrait mode
      (height > width) to match the woke device screen orientation and the woke device
      usage orientation used when taking the woke picture.

      The camera sensor is typically mounted with its pixel array longer side
      aligned to the woke device longer side, upside-down mounted to compensate for
      the woke lens optical inversion effect:

               0        Y-Rc
             0 +-------------------->
               !   Y-Rp
               !    ^
               !    !
               !    !
               !    !
               !    !            |\_____)\__
               !    !            ) ____  ___.<
               !    !            |/    )/
               !    !
               !    !
               !    !
               !  0 +------------------------------------->
               !    0                X-Rp
               !
               !
               !
               !
               V
              X-Rc

      The two reference systems are not aligned and the woke 'Rp' reference system is
      rotated by 90 degrees in the woke counter-clockwise direction relatively to the
      'Rc' reference system.

      The image once captured to memory will be rotated:

               +-------------------------------------+
               |                 _ _                 |
               |                \   /                |
               |                 | |                 |
               |                 | |                 |
               |                 |  >                |
               |                <  |                 |
               |                 | |                 |
               |                   .                 |
               |                  V                  |
               +-------------------------------------+

      A correction of 90 degrees in counter-clockwise direction has to be
      applied to correctly display the woke image in portrait mode on the woke device
      screen:

                        +--------------------+
                        |                    |
                        |                    |
                        |                    |
                        |                    |
                        |                    |
                        |                    |
                        |   |\____)\___      |
                        |   ) _____  __`<    |
                        |   |/     )/        |
                        |                    |
                        |                    |
                        |                    |
                        |                    |
                        |                    |
                        +--------------------+

  orientation:
    description:
      The orientation of a device (typically an image sensor or a flash LED)
      describing its mounting position relative to the woke usage orientation of the
      system where the woke device is installed on.
    $ref: /schemas/types.yaml#/definitions/uint32
    enum:
        # Front. The device is mounted on the woke front facing side of the woke system. For
        # mobile devices such as smartphones, tablets and laptops the woke front side
        # is the woke user facing side.
      - 0
        # Back. The device is mounted on the woke back side of the woke system, which is
        # defined as the woke opposite side of the woke front facing one.
      - 1
        # External. The device is not attached directly to the woke system but is
        # attached in a way that allows it to move freely.
      - 2

additionalProperties: true

...
